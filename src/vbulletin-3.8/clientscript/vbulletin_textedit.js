function vB_Text_Editor(editorid,mode,parsetype,parsesmilies,initial_text,ajax_extra){this.editorid=editorid,this.wysiwyg_mode=parseInt(mode,10)?1:0,this.initialized=!1,this.parsetype=parsetype===void 0?"nonforum":parsetype,this.ajax_extra=parsetype===void 0?"":ajax_extra,this.parsesmilies=parsesmilies===void 0?1:parsesmilies,this.popupmode="undefined"==typeof vBmenu?!1:!0,this.controlbar=fetch_object(this.editorid+"_controls"),this.textobj=fetch_object(this.editorid+"_textarea"),this.buttons=Array(),this.popups=Array(),this.prompt_popup=null,this.fontstate=null,this.sizestate=null,this.colorstate=null,this.clipboard="",this.disabled=!1,this.history=new vB_History,this.influx=0,this.allowbasicbbcode="undefined"!=typeof allowbasicbbcode&&allowbasicbbcode?!0:!1,this.ltr="undefined"!=typeof ltr&&"right"==ltr?"right":"left",this.init=function(){this.initialized||(this.textobj.disabled=!1,this.tempiframe&&this.tempiframe.parentNode.removeChild(this.tempiframe),this.set_editor_contents(initial_text),this.set_editor_functions(),this.init_controls(),this.init_smilies(fetch_object(this.editorid+"_smiliebox")),"undefined"==typeof smilie_window||smilie_window.closed||this.init_smilies(smilie_window.document.getElementById("smilietable")),this.captcha=document.getElementById("imagestamp"),null!=this.captcha&&this.captcha.setAttribute("tabIndex",1),this.initialized=!0)},this.check_focus=function(){(!this.editwin.hasfocus||is_moz&&is_mac)&&(this.editwin.focus(),is_opera&&this.editwin.focus())},this.init_controls=function(){var b,c,d,e,f,a=Array();if(null!=this.controlbar){for(d=fetch_tags(this.controlbar,"div"),b=0;d.length>b;b++)if("imagebutton"==d[b].className&&d[b].id&&(a[a.length]=d[b].id,is_ie))for(e=d[b].getElementsByTagName("img"),c=0;e.length>c;c++)""==e[c].alt&&(e[c].title=d[b].title);for(b=0;a.length>b;b++)f=fetch_object(a[b]),-1!=f.id.indexOf(this.editorid+"_cmd_")?this.init_command_button(f):-1!=f.id.indexOf(this.editorid+"_popup_")&&this.init_popup_button(f);set_unselectable(this.controlbar)}},this.init_smilies=function(a){if(null!=a)for(var b=fetch_tags(a,"img"),c=0;b.length>c;c++)b[c].id&&0!=b[c].id.indexOf("_smilie_")&&(b[c].style.cursor=pointer_cursor,b[c].editorid=this.editorid,b[c].onclick=vB_Text_Editor_Events.prototype.smilie_onclick,b[c].unselectable="on")},this.init_command_button=function(a){a.cmd=a.id.substr(a.id.indexOf("_cmd_")+5),a.editorid=this.editorid,this.buttons[a.cmd]=a,"switchmode"==a.cmd?AJAX_Compatible?(a.state=this.wysiwyg_mode?!0:!1,this.set_control_style(a,"button",this.wysiwyg_mode?"selected":"normal")):a.parentNode.removeChild(a):(a.state=!1,a.mode="normal",("bold"==a.cmd||"italic"==a.cmd||"underline"==a.cmd)&&(this.allowbasicbbcode=!0)),a.onclick=a.onmousedown=a.onmouseover=a.onmouseout=vB_Text_Editor_Events.prototype.command_button_onmouseevent},this.init_popup_button=function(a){if(a.cmd=a.id.substr(a.id.indexOf("_popup_")+7),this.popupmode){vBmenu.register(a.id,!0),vBmenu.menus[a.id].open_steps=5,a.editorid=this.editorid,a.state=!1,this.buttons[a.cmd]=a;var b,c;if("fontname"==a.cmd){this.fontout=fetch_object(this.editorid+"_font_out"),this.fontout.innerHTML=a.title,this.fontoptions={"":this.fontout};for(b in fontoptions)YAHOO.lang.hasOwnProperty(fontoptions,b)&&(c=document.createElement("div"),c.id=this.editorid+"_fontoption_"+fontoptions[b],c.style.width=this.fontout.style.width,c.style.display="none",c.innerHTML=fontoptions[b],this.fontoptions[fontoptions[b]]=this.fontout.parentNode.appendChild(c))}else if("fontsize"==a.cmd){this.sizeout=fetch_object(this.editorid+"_size_out"),this.sizeout.innerHTML=a.title,this.sizeoptions={"":this.sizeout};for(b in sizeoptions)YAHOO.lang.hasOwnProperty(sizeoptions,b)&&(c=document.createElement("div"),c.id=this.editorid+"_sizeoption_"+sizeoptions[b],c.style.width=this.sizeout.style.width,c.style.display="none",c.innerHTML=sizeoptions[b],this.sizeoptions[sizeoptions[b]]=this.sizeout.parentNode.appendChild(c))}a._onmouseover=a.onmouseover,a._onclick=a.onclick,a.onmouseover=a.onmouseout=a.onclick=vB_Text_Editor_Events.prototype.popup_button_onmouseevent,vBmenu.menus[a.id]._show=vBmenu.menus[a.id].show,vBmenu.menus[a.id].show=vB_Text_Editor_Events.prototype.popup_button_show}else this.build_select(a)},this.build_select=function(a){var b=document.createElement("select");b.id=this.editorid+"_select_"+a.cmd,b.editorid=this.editorid,b.cmd=a.cmd;var c=document.createElement("option");c.value="",c.text=a.title,b.add(c,is_ie?b.options.length:null),c=document.createElement("option"),c.value="",c.text=" ",b.add(c,is_ie?b.options.length:null);var d;switch(a.cmd){case"fontname":for(d=0;fontoptions.length>d;d++)c=document.createElement("option"),c.value=fontoptions[d],c.text=fontoptions[d].length>10?fontoptions[d].substr(0,10)+"...":fontoptions[d],b.add(c,is_ie?b.options.length:null);b.onchange=vB_Text_Editor_Events.prototype.formatting_select_onchange;break;case"fontsize":for(d=0;sizeoptions.length>d;d++)c=document.createElement("option"),c.value=sizeoptions[d],c.text=sizeoptions[d],b.add(c,is_ie?b.options.length:null);b.onchange=vB_Text_Editor_Events.prototype.formatting_select_onchange;break;case"forecolor":for(d in coloroptions)YAHOO.lang.hasOwnProperty(coloroptions,d)&&(c=document.createElement("option"),c.value=coloroptions[d],c.text=PHP.trim((coloroptions[d].length>5?coloroptions[d].substr(0,5)+"...":coloroptions[d]).replace(RegExp("([A-Z])","g")," $1")),c.style.backgroundColor=d,b.add(c,is_ie?b.options.length:null));b.onchange=vB_Text_Editor_Events.prototype.formatting_select_onchange;break;case"smilie":for(var e in smilieoptions)if(YAHOO.lang.hasOwnProperty(smilieoptions,e))for(var f in smilieoptions[e])YAHOO.lang.hasOwnProperty(smilieoptions[e],f)&&"more"!=f&&(c=document.createElement("option"),c.value=smilieoptions[e][f][1],c.text=smilieoptions[e][f][1],c.smilieid=f,c.smiliepath=smilieoptions[e][f][0],c.smilietitle=smilieoptions[e][f][2],b.add(c,is_ie?b.options.length:null));b.onchange=vB_Text_Editor_Events.prototype.smilieselect_onchange;break;case"attach":b.onmouseover=vB_Text_Editor_Events.prototype.attachselect_onmouseover,b.onchange=vB_Text_Editor_Events.prototype.attachselect_onchange}for(;a.hasChildNodes();)a.removeChild(a.firstChild);this.buttons[a.cmd]=a.appendChild(b)},this.init_popup_menu=function(a){if(this.disabled)return!1;var b;switch(a.cmd){case"fontname":b=this.init_menu_container("fontname","200px","250px","auto"),this.build_fontname_popup(a,b);break;case"fontsize":b=this.init_menu_container("fontsize","auto","auto","visible"),this.build_fontsize_popup(a,b);break;case"forecolor":b=this.init_menu_container("forecolor","auto","auto","visible"),this.build_forecolor_popup(a,b);break;case"smilie":b=this.init_menu_container("smilie","175px","250px","auto"),this.build_smilie_popup(a,b);break;case"attach":if("undefined"==typeof vB_Attachments||!vB_Attachments.has_attachments())return fetch_object("manage_attachments_button").onclick(),!1;b=this.init_menu_container("attach","auto","auto","visible"),this.build_attachments_popup(b,a)}return this.popups[a.cmd]=this.controlbar.appendChild(b),set_unselectable(b),!0},this.init_menu_container=function(a,b,c,d){var e=document.createElement("div");return e.id=this.editorid+"_popup_"+a+"_menu",e.className="vbmenu_popup",e.style.display="none",e.style.cursor="default",e.style.padding="3px",e.style.width=b,e.style.height=c,e.style.overflow=d,e},this.build_fontname_popup=function(a,b){for(var c in fontoptions)if(YAHOO.lang.hasOwnProperty(fontoptions,c)){var d=document.createElement("div");d.innerHTML='<font face="'+fontoptions[c]+'">'+fontoptions[c]+"</font>",d.className="ofont",d.style.textAlign="left",d.title=fontoptions[c],d.cmd=a.cmd,d.controlkey=a.id,d.editorid=this.editorid,d.onmouseover=d.onmouseout=d.onmouseup=d.onmousedown=vB_Text_Editor_Events.prototype.menuoption_onmouseevent,d.onclick=vB_Text_Editor_Events.prototype.formatting_option_onclick,b.appendChild(d)}},this.build_fontsize_popup=function(a,b){for(var c in sizeoptions)if(YAHOO.lang.hasOwnProperty(sizeoptions,c)){var d=document.createElement("div");d.innerHTML='<font size="'+sizeoptions[c]+'">'+sizeoptions[c]+"</font>",d.className="osize",d.style.textAlign="center",d.title=sizeoptions[c],d.cmd=a.cmd,d.controlkey=a.id,d.editorid=this.editorid,d.onmouseover=d.onmouseout=d.onmouseup=d.onmousedown=vB_Text_Editor_Events.prototype.menuoption_onmouseevent,d.onclick=vB_Text_Editor_Events.prototype.formatting_option_onclick,b.appendChild(d)}},this.build_forecolor_popup=function(a,b){var c=fetch_object(this.editorid+"_color_out");c.editorid=this.editorid,c.onclick=vB_Text_Editor_Events.prototype.colorout_onclick;var d=document.createElement("table");d.cellPadding=0,d.cellSpacing=0,d.border=0;var e=0;for(var f in coloroptions)if(YAHOO.lang.hasOwnProperty(coloroptions,f)){if(0==e%8)var g=d.insertRow(-1);e++;var h=document.createElement("div");h.style.backgroundColor=coloroptions[f];var i=g.insertCell(-1);i.style.textAlign="center",i.className="ocolor",i.appendChild(h),i.cmd=a.cmd,i.editorid=this.editorid,i.controlkey=a.id,i.colorname=coloroptions[f],i.id=this.editorid+"_color_"+coloroptions[f],i.onmouseover=i.onmouseout=i.onmouseup=i.onmousedown=vB_Text_Editor_Events.prototype.menuoption_onmouseevent,i.onclick=vB_Text_Editor_Events.prototype.coloroption_onclick}b.appendChild(d)},this.build_smilie_popup=function(a,b){for(var c in smilieoptions)if(YAHOO.lang.hasOwnProperty(smilieoptions,c)){var d,e=document.createElement("div");e.className="thead",e.innerHTML=c,b.appendChild(e);for(var f in smilieoptions[c])YAHOO.lang.hasOwnProperty(smilieoptions[c],f)&&("more"==f?(d=document.createElement("div"),d.className="thead",d.innerHTML=smilieoptions[c][f],d.style.cursor=pointer_cursor,d.editorid=this.editorid,d.controlkey=a.id,d.onclick=vB_Text_Editor_Events.prototype.smiliemore_onclick):(d=document.createElement("div"),d.editorid=this.editorid,d.controlkey=a.id,d.smilieid=f,d.smilietext=smilieoptions[c][f][1],d.smilietitle=smilieoptions[c][f][2],d.className="osmilie",d.innerHTML='<img src="'+smilieoptions[c][f][0]+'" alt="'+PHP.htmlspecialchars(smilieoptions[c][f][2])+'" /> '+PHP.htmlspecialchars(smilieoptions[c][f][2]),d.onmouseover=d.onmouseout=d.onmousedown=d.onmouseup=vB_Text_Editor_Events.prototype.menuoption_onmouseevent,d.onclick=vB_Text_Editor_Events.prototype.smilieoption_onclick),b.appendChild(d))}},this.build_attachments_popup=function(a,b){var c,d;if(this.popupmode){for(;a.hasChildNodes();)a.removeChild(a.firstChild);d=document.createElement("div"),d.editorid=this.editorid,d.controlkey=b.id,d.className="thead",d.style.cursor=pointer_cursor,d.style.whiteSpace="nowrap",d.innerHTML=fetch_object("manage_attachments_button").value,d.title=fetch_object("manage_attachments_button").title,d.onclick=vB_Text_Editor_Events.prototype.attachmanage_onclick,a.appendChild(d);var e=0;for(c in vB_Attachments.attachments)YAHOO.lang.hasOwnProperty(vB_Attachments.attachments,c)&&(d=document.createElement("div"),d.editorid=this.editorid,d.controlkey=b.id,d.className="osmilie",d.attachmentid=c,d.style.whiteSpace="nowrap",d.innerHTML='<img src="'+vB_Attachments.attachments[c].imgpath+'" alt="" /> '+vB_Attachments.attachments[c].filename,d.onmouseover=d.onmouseout=d.onmousedown=d.onmouseup=vB_Text_Editor_Events.prototype.menuoption_onmouseevent,d.onclick=vB_Text_Editor_Events.prototype.attachoption_onclick,a.appendChild(d),e++);e>1&&(d=document.createElement("div"),d.editorid=this.editorid,d.controlkey=b.id,d.className="osmilie",d.style.fontWeight="bold",d.style.paddingLeft="25px",d.style.whiteSpace="nowrap",d.innerHTML=vbphrase.insert_all,d.onmouseover=d.onmouseout=d.onmousedown=d.onmouseup=vB_Text_Editor_Events.prototype.menuoption_onmouseevent,d.onclick=vB_Text_Editor_Events.prototype.attachinsertall_onclick,a.appendChild(d))}else{for(;a.options.length>2;)a.remove(a.options.length-1);for(c in vB_Attachments.attachments)if(YAHOO.lang.hasOwnProperty(vB_Attachments.attachments,c)){var f=document.createElement("option");f.value=c,f.text=vB_Attachments.attachments[c].filename,a.add(f,is_ie?a.options.length:null)}}set_unselectable(a)},this.menu_context=function(a,b){if(!this.disabled)switch(a.state){case!0:this.set_control_style(a,"button","down");break;default:switch(b){case"mouseout":this.set_control_style(a,"button","normal");break;case"mousedown":this.set_control_style(a,"popup","down");break;case"mouseup":case"mouseover":this.set_control_style(a,"button","hover")}}},this.button_context=function(a,b,c){if(!this.disabled)switch(c===void 0&&(c="button"),a.state){case!0:switch(b){case"mouseover":case"mousedown":case"mouseup":this.set_control_style(a,c,"down");break;case"mouseout":this.set_control_style(a,c,"selected")}break;default:switch(b){case"mouseover":case"mouseup":this.set_control_style(a,c,"hover");break;case"mousedown":this.set_control_style(a,c,"down");break;case"mouseout":this.set_control_style(a,c,"normal")}}},this.set_control_style=function(a,b,c){if(a.mode!=c&&(a.mode=c,istyle="pi_"+b+"_"+a.mode,"undefined"!=typeof istyles&&istyles[istyle]!==void 0)){a.style.background=istyles[istyle][0],a.style.color=istyles[istyle][1],"menu"!=b&&(a.style.padding=istyles[istyle][2]),a.style.border=istyles[istyle][3];for(var d=fetch_tags(a,"td"),e=0;d.length>e;e++)switch(d[e].className){case"popup_feedback":"left"==this.ltr?d[e].style.borderRight="normal"==c?istyles.pi_menu_normal[3]:istyles[istyle][3]:d[e].style.borderLeft="normal"==c?istyles.pi_menu_normal[3]:istyles[istyle][3];break;case"popup_pickbutton":d[e].style.borderColor="normal"==c?istyles.pi_menu_normal[0]:istyles[istyle][0];break;case"alt_pickbutton":a.state?"left"==this.ltr?(d[e].style.paddingLeft=istyles.pi_button_normal[2],d[e].style.borderLeft=istyles.pi_button_normal[3]):(d[e].style.paddingRight=istyles.pi_button_normal[2],d[e].style.borderRight=istyles.pi_button_normal[3]):"left"==this.ltr?(d[e].style.paddingLeft=istyles[istyle][2],d[e].style.borderLeft=istyles[istyle][3]):(d[e].style.paddingRight=istyles[istyle][2],d[e].style.borderRight=istyles[istyle][3])}}},this.format=function(a,b,c){if(a=do_an_e(a),this.disabled)return!1;if("redo"!=b&&this.history.add_snapshot(this.get_editor_contents()),"switchmode"==b)return switch_editor_mode(this.editorid),void 0;if("resize"==b.substr(0,6)){var d=parseInt(b.substr(9),10),e="1"==parseInt(b.substr(7,1),10)?1:-1;return this.resize_editor(d*e),void 0}this.check_focus();var f;if("wrap"==b.substr(0,4))f=this.wrap_tags(b.substr(6),"1"==b.substr(4,1)?!0:!1);else if(this[b])f=this[b](a);else try{f=this.apply_format(b,!1,c===void 0?!0:c)}catch(a){this.handle_error(b,a),f=!1}return"undo"!=b&&this.history.add_snapshot(this.get_editor_contents()),this.set_context(b),this.check_focus(),f},this.insertimage=function(a,b){return b===void 0&&(b=this.show_prompt(vbphrase.enter_image_url,"http://",!0)),(b=this.verify_prompt(b))?this.apply_format("insertimage",!1,b):!1},this.wrap_tags=function(a,b,c){switch(a=a.toUpperCase()){case"CODE":case"HTML":case"PHP":this.apply_format("removeformat")}c===void 0&&(c=this.get_selection(),c=c===!1?"":new String(c));var d;if(b===!0){var e=this.show_prompt(construct_phrase(vbphrase.enter_tag_option,"["+a+"]"),"",!1);if(!(e=this.verify_prompt(e)))return!1;d="["+a+'="'+e+'"]'}else d=b!==!1?"["+a+'="'+b+'"]':"["+a+"]";var f="[/"+a+"]",g=d+c+f;return this.insert_text(g,d.vBlength(),f.vBlength()),!1},this.spelling=function(){if(is_ie)try{eval("new ActiveXObject('ieSpell.ieSpellExtension').CheckDocumentNode(this.spellobj);")}catch(e){-2146827859==e.number&&confirm(vbphrase.iespell_not_installed)&&window.open("http://www.iespell.com/download.php")}},this.handle_error=function(){},this.show_prompt=function(a,b,c){var d;if(YAHOO.env.ua.ie>=7){var f,e=fetch_tags(document,"base");f=e&&e[0]&&e[0].href?e[0].href:"",d=window.showModalDialog(f+"clientscript/ieprompt.html?",{value:b,label:a,dir:document.dir,title:document.title,forceltr:c!==void 0?c:!1},"dialogWidth:320px; dialogHeight:150px; dialogTop:"+(parseInt(window.screenTop)+parseInt(window.event.clientY)+parseInt(document.body.scrollTop)-100)+"px; dialogLeft:"+(parseInt(window.screenLeft)+parseInt(window.event.clientX)+parseInt(document.body.scrollLeft)-160)+"px; resizable: No;")}else d=prompt(a,b);return d===void 0?!1:0==d||null==d?d:PHP.trim(new String(d))},this.verify_prompt=function(a){switch(a){case"http://":case"null":case"undefined":case"false":case"":case null:case!1:return!1;default:return a}},this.open_smilie_window=function(a,b){smilie_window=openWindow("misc.php?"+SESSIONURL+"do=getsmilies&editorid="+this.editorid,a,b,"smilie_window"),window.onunload=vB_Text_Editor_Events.prototype.smiliewindow_onunload},this.resize_editor=function(a){var b=parseInt(this.editbox.style.height,10)+a;b>=60&&(this.editbox.style.height=b+"px",0!=a%99&&set_cookie("editor_height",b))},this.destroy_popup=function(a){this.popups[a].parentNode.removeChild(this.popups[a]),this.popups[a]=null},this.destroy=function(){var a;for(a in this.buttons)YAHOO.lang.hasOwnProperty(this.buttons,a)&&this.set_control_style(this.buttons[a],"button","normal");for(var b in this.popups)YAHOO.lang.hasOwnProperty(this.popups,b)&&this.destroy_popup(b);if(this.fontoptions){for(a in this.fontoptions)YAHOO.lang.hasOwnProperty(this.fontoptions,a)&&""!=a&&this.fontoptions[a].parentNode.removeChild(this.fontoptions[a]);this.fontoptions[""].style.display=""}if(this.sizeoptions){for(a in this.sizeoptions)YAHOO.lang.hasOwnProperty(this.sizeoptions,a)&&""!=a&&this.sizeoptions[a].parentNode.removeChild(this.sizeoptions[a]);this.sizeoptions[""].style.display=""}},this.collapse_selection_end=function(){var range;if(this.editdoc.selection)range=this.editdoc.selection.createRange(),eval("range.move('character', -1);"),range.collapse(!1),range.select();else if(document.selection&&document.selection.createRange)range=document.selection.createRange(),range.collapse(!1),range.select();else if(this.editdoc.selectionStart!==void 0){var sel_text=this.editdoc.value.substr(this.editdoc.selectionStart,this.editdoc.selectionEnd-this.editdoc.selectionStart);this.editdoc.selectionStart=this.editdoc.selectionStart+sel_text.vBlength()}else window.getSelection},this.wysiwyg_mode?(this.disable_editor=function(a){if(!this.disabled){this.disabled=!0;var b=fetch_object(this.editorid+"_hider");b&&b.parentNode.removeChild(b);var c=document.createElement("div");c.id=this.editorid+"_hider",c.className="wysiwyg",c.style.border="2px inset",c.style.margin="0px",c.style.padding="0px",c.style.width=this.editbox.style.width,c.style.height=this.editbox.style.height;var d=document.createElement("div");d.style.margin="8px",d.innerHTML=a,c.appendChild(d),this.editbox.parentNode.appendChild(c),this.editbox.style.width="0px",this.editbox.style.height="0px",this.editbox.style.border="none"}},this.enable_editor=function(a){a!==void 0&&this.set_editor_contents(a);var b=fetch_object(this.editorid+"_hider");b&&b.parentNode.removeChild(b),this.disabled=!1},this.write_editor_contents=function(a,b){""==a&&(is_ie?a="<p></p>":is_moz&&(a="<br />")),this.editdoc&&this.editdoc.initialized?this.editdoc.body.innerHTML=a:(this.editdoc=this.editwin.document,this.editdoc.open("text/html","replace"),this.editdoc.write(a),this.editdoc.close(),b&&(is_moz?this.editdoc.designMode="on":this.editdoc.body.contentEditable=!0),this.editdoc.body.spellcheck=!0,this.editdoc.initialized=!0,this.set_editor_style()),this.set_direction()},this.set_editor_contents=function(a){if(fetch_object(this.editorid+"_iframe"))this.editbox=fetch_object(this.editorid+"_iframe");else{var b=document.createElement("iframe");is_ie&&"https:"==window.location.protocol&&(b.src="clientscript/index.html"),this.editbox=this.textobj.parentNode.appendChild(b),this.editbox.id=this.editorid+"_iframe",this.editbox.tabIndex=1}is_ie||(this.editbox.style.border="2px inset"),this.set_editor_width(this.textobj.style.oWidth!==void 0?this.textobj.style.oWidth:this.textobj.style.width),this.editbox.style.height=this.textobj.style.height,this.textobj.style.display="none",this.editwin=this.editbox.contentWindow,this.editdoc=this.editwin.document,this.write_editor_contents(a===void 0?this.textobj.value:a,!0),"rtl"==this.editdoc.dir,this.spellobj=this.editdoc.body,this.editdoc.editorid=this.editorid,this.editwin.editorid=this.editorid},this.set_editor_width=function(a){this.editbox.style.width=a},this.set_direction=function(){this.editdoc.dir=this.textobj.dir},this.set_editor_style=function(){for(var a="",b=!1,c=fetch_all_stylesheets(document.styleSheets),d=0;c.length>d;d++){try{var e=c[d].cssRules?c[d].cssRules:c[d].rules;if(0>=e.length)continue}catch(f){continue}for(var g=0;e.length>g;g++)if(e[g].selectorText){var h=!1,i=Array();if(e[g].selectorText.indexOf(".wysiwyg")>=0){for(var j=e[g].selectorText.split(","),k=0;j.length>k;k++)j[k].indexOf(".wysiwyg")>=0&&i.push(j[k]),j[k].indexOf("#usercss")>=0&&(b=!0);h=!0}if(h){var l="{ "+e[g].style.cssText+" }";is_moz&&(l=l.replace(/; /g," !important; ")),a+=i.join(", ")+" "+l+"\n"}}}if(a+=" p { margin: 0px; } .inlineimg { vertical-align: middle; }",is_ie)this.editdoc.createStyleSheet().cssText=a;else{var m=this.editdoc.createElement("style");m.type="text/css",m.innerHTML=a,this.editdoc.documentElement.childNodes[0].appendChild(m)}b&&(this.editdoc.body.parentNode.id="usercss"),this.editdoc.body.className="wysiwyg"},this.set_editor_functions=function(){this.editdoc.onmouseup=vB_Text_Editor_Events.prototype.editdoc_onmouseup,this.editdoc.onkeyup=vB_Text_Editor_Events.prototype.editdoc_onkeyup,this.editdoc.attachEvent&&this.editdoc.body.attachEvent("onresizestart",vB_Text_Editor_Events.prototype.editdoc_onresizestart),this.editwin.onfocus=vB_Text_Editor_Events.prototype.editwin_onfocus,this.editwin.onblur=vB_Text_Editor_Events.prototype.editwin_onblur},this.set_context=function(a){for(var b in contextcontrols)if(YAHOO.lang.hasOwnProperty(contextcontrols,b)){var c=fetch_object(this.editorid+"_cmd_"+contextcontrols[b]);if(null!=c){var d=this.editdoc.queryCommandState(contextcontrols[b]);c.state!=d&&(c.state=d,this.button_context(c,c.cmd==a?"mouseover":"mouseout"))}}this.set_font_context(),this.set_size_context(),this.set_color_context()},this.set_font_context=function(a){if(this.buttons.fontname){switch(a===void 0&&(a=this.editdoc.queryCommandValue("fontname")),a){case"":!is_ie&&window.getComputedStyle&&(a=this.editdoc.body.style.fontFamily);break;case null:a=""}if(a!=this.fontstate){this.fontstate=a;var c,b=PHP.ucfirst(this.fontstate,",");if(this.popupmode)for(c in this.fontoptions)YAHOO.lang.hasOwnProperty(this.fontoptions,c)&&(this.fontoptions[c].style.display=c==b?"":"none");else for(c=0;this.buttons.fontname.options.length>c;c++)if(this.buttons.fontname.options[c].value==b){this.buttons.fontname.selectedIndex=c;break}}}},this.set_size_context=function(a){if(this.buttons.fontsize){switch(a===void 0&&(a=this.editdoc.queryCommandValue("fontsize")),a){case null:case"":is_moz&&(a=this.translate_fontsize(this.editdoc.body.style.fontSize))}if(a!=this.sizestate){this.sizestate=a;var b;if(this.popupmode)for(b in this.sizeoptions)YAHOO.lang.hasOwnProperty(this.sizeoptions,b)&&(this.sizeoptions[b].style.display=b==this.sizestate?"":"none");else for(b=0;this.buttons.fontsize.options.length>b;b++)if(this.buttons.fontsize.options[b].value==this.sizestate){this.buttons.fontsize.selectedIndex=b;break}}}},this.set_color_context=function(a){if(this.buttons.forecolor&&(a===void 0&&(a=this.editdoc.queryCommandValue("forecolor")),a!=this.colorstate))if(this.popupmode){var b=fetch_object(this.editorid+"_color_"+this.translate_color_commandvalue(this.colorstate));null!=b&&(b.state=!1,this.button_context(b,"mouseout","menu")),this.colorstate=a,elmid=this.editorid+"_color_"+this.translate_color_commandvalue(a),b=fetch_object(elmid),null!=b&&(b.state=!0,this.button_context(b,"mouseout","menu"))}else{this.colorstate=a,a=this.translate_color_commandvalue(this.colorstate);for(var c=0;this.buttons.forecolor.options.length>c;c++)if(this.buttons.forecolor.options[c].value==a){this.buttons.forecolor.selectedIndex=c;break}}},this.translate_color_commandvalue=function(a){return this.translate_silly_hex((255&a).toString(16),(255&a>>8).toString(16),(255&a>>16).toString(16))},this.translate_silly_hex=function(a,b,c){return coloroptions["#"+(PHP.str_pad(a,2,0)+PHP.str_pad(b,2,0)+PHP.str_pad(c,2,0)).toUpperCase()]},this.apply_format=function(a,b,c){return this.editdoc.execCommand(a,b===void 0?!1:b,c===void 0?!0:c),!1},this.createlink=function(a,b){return this.apply_format("createlink",is_ie,b===void 0?!0:b)},this.email=function(a,b){if(b===void 0&&(b=this.show_prompt(vbphrase.enter_email_link,"",!0)),b=this.verify_prompt(b),b===!1)return this.apply_format("unlink");var c=this.get_selection();return this.insert_text('<a href="mailto:'+b+'">'+(c?c:b)+"</a>",c?!0:!1)},this.insert_smilie=function(a,b,c,d){return this.check_focus(),this.insert_text('<img src="'+c+'" border="0" class="inlineimg" alt="0" smilieid="'+d+'" />',!1)},this.get_editor_contents=function(){return this.editdoc.body.innerHTML},this.get_selection=function(){var a=this.editdoc.selection.createRange();if(a.htmlText&&a.text)return a.htmlText;for(var b="",c=0;a.length>c;c++)b+=a.item(c).outerHTML;return b},this.insert_text=function(a,b,c){this.check_focus(),this.editdoc.selection!==void 0&&"Text"!=this.editdoc.selection.type&&"None"!=this.editdoc.selection.type&&(b=!1,this.editdoc.selection.clear());var d=this.editdoc.selection.createRange();d.pasteHTML(a),-1==a.indexOf("\n")&&(b===!1||(b!==void 0?(d.moveStart("character",-a.vBlength()+b),d.moveEnd("character",-c)):d.moveStart("character",-a.vBlength())),d.select())},this.prepare_submit=function(a,b){this.textobj.value=this.get_editor_contents();var c=validatemessage(stripcode(this.textobj.value,!0),a,b);return c?c:null!=this.captcha&&this.captcha.failed?!1:(this.check_focus(),!1)},is_moz?(this._set_editor_contents=this.set_editor_contents,this.set_editor_contents=function(a){this._set_editor_contents(a),this.editdoc.addEventListener("keypress",vB_Text_Editor_Events.prototype.editdoc_onkeypress,!0)},this.translate_color_commandvalue=function(a){if((""==a||null==a)&&(a=window.getComputedStyle(this.editdoc.body,null).getPropertyValue("color")),0==a.toLowerCase().indexOf("rgb")){var b=a.match(/^rgb\s*\(([0-9]+),\s*([0-9]+),\s*([0-9]+)\)$/);return b?this.translate_silly_hex((255&b[1]).toString(16),(255&b[2]).toString(16),(255&b[3]).toString(16)):this.translate_color_commandvalue(null)}return a},this.translate_fontsize=function(a){switch(a){case"7.5pt":case"10px":return 1;case"10pt":return 2;case"12pt":return 3;case"14pt":return 4;case"18pt":return 5;case"24pt":return 6;case"36pt":return 7;default:return""}},this._apply_format=this.apply_format,this.apply_format=function(a,b,c){return this.editdoc.execCommand("useCSS",!1,!0),this._apply_format(a,b,c)},this._createlink=this.createlink,this.createlink=function(a,b){return b===void 0&&(b=this.show_prompt(vbphrase.enter_link_url,"http://",!0)),(b=this.verify_prompt(b))!==!1&&(this.get_selection()?(this.apply_format("unlink"),this._createlink(a,b)):this.insert_text('<a href="'+b+'">'+b+"</a>")),!0},this.insert_smilie=function(a,b,c,d){this.check_focus();try{this.apply_format("InsertImage",!1,c);for(var e=fetch_tags(this.editdoc.body,"img"),f=0;e.length>f;f++)e[f].src==c&&(e[f].className="inlineimg",1>e[f].getAttribute("smilieid")&&(e[f].setAttribute("smilieid",d),e[f].setAttribute("border","0")))}catch(a){}},this.get_selection=function(){selection=this.editwin.getSelection(),this.check_focus();var a=selection?selection.getRangeAt(0):this.editdoc.createRange();return this.read_nodes(a.cloneContents(),!1)},this.insert_text=function(a){this.editdoc.execCommand("insertHTML",!1,a)},this.set_editor_functions=function(){this.editdoc.addEventListener("mouseup",vB_Text_Editor_Events.prototype.editdoc_onmouseup,!0),this.editdoc.addEventListener("keyup",vB_Text_Editor_Events.prototype.editdoc_onkeyup,!0),this.editwin.addEventListener("focus",vB_Text_Editor_Events.prototype.editwin_onfocus,!0),this.editwin.addEventListener("blur",vB_Text_Editor_Events.prototype.editwin_onblur,!0)},this.add_range=function(a){this.check_focus();var b=this.editwin.getSelection(),c=this.editdoc.createRange();c.selectNodeContents(a),b.removeAllRanges(),b.addRange(c)},this.read_nodes=function(a,b){var c="",d=/_moz/i;switch(a.nodeType){case Node.ELEMENT_NODE:case Node.DOCUMENT_FRAGMENT_NODE:var e,f;if(b){e=!a.hasChildNodes(),c="<"+a.tagName.toLowerCase();var g=a.attributes;for(f=0;g.length>f;++f){var h=g.item(f);!h.specified||h.name.match(d)||h.value.match(d)||(c+=" "+h.name.toLowerCase()+'="'+h.value+'"')}c+=e?" />":">"}for(f=a.firstChild;f;f=f.nextSibling)c+=this.read_nodes(f,!0);b&&!e&&(c+="</"+a.tagName.toLowerCase()+">");break;case Node.TEXT_NODE:c=PHP.htmlspecialchars(a.data)}return c},this.insert_node_at_selection=function(a){this.check_focus();var b=this.editwin.getSelection(),c=b?b.getRangeAt(0):this.editdoc.createRange();b.removeAllRanges(),c.deleteContents();var d=c.startContainer,e=c.startOffset;switch(d.nodeType){case Node.ELEMENT_NODE:g=a.nodeType==Node.DOCUMENT_FRAGMENT_NODE?a.firstChild:a,d.insertBefore(a,d.childNodes[e]),this.add_range(g);break;case Node.TEXT_NODE:if(a.nodeType==Node.TEXT_NODE){var f=e+a.length;d.insertData(e,a.data),c=this.editdoc.createRange(),c.setEnd(d,f),c.setStart(d,f),b.addRange(c)}else{d=d.splitText(e);var g;g=a.nodeType==Node.DOCUMENT_FRAGMENT_NODE?a.firstChild:a,d.parentNode.insertBefore(a,d),this.add_range(g)}}}):is_opera&&(this._createlink=this.createlink,this.createlink=function(a,b){return b===void 0&&(b=this.show_prompt(vbphrase.enter_link_url,"http://",!0)),(b=this.verify_prompt(b))!==!1&&(this.get_selection()?(this.apply_format("unlink"),this._createlink(a,b)):this.insert_text('<a href="'+b+'">'+b+"</a>")),!0},this.insert_smilie=function(a,b,c,d){this.check_focus();try{this.apply_format("InsertImage",!1,c);for(var e=fetch_tags(this.editdoc.body,"img"),f=0;e.length>f;f++)e[f].src==c&&(e[f].className="inlineimg",1>e[f].getAttribute("smilieid")&&(e[f].setAttribute("smilieid",d),e[f].setAttribute("border","0")))}catch(a){}},this.get_selection=function(){selection=this.editwin.getSelection(),this.check_focus(),range=selection?selection.getRangeAt(0):this.editdoc.createRange();var a=document.implementation.createLSSerializer();return a.writeToString(range.cloneContents())},this.insert_text=function(a){this.editdoc.execCommand("insertHTML",!1,a)})):(this.disable_editor=function(a){this.disabled||(this.disabled=!0,a!==void 0&&(this.editbox.value=a),this.editbox.disabled=!0)},this.enable_editor=function(a){a!==void 0&&(this.editbox.value=a),this.editbox.disabled=!1,this.disabled=!1},this.write_editor_contents=function(a){this.textobj.value=a},this.set_editor_contents=function(a){var b=this.textobj.parentNode.getElementsByTagName("iframe")[0];b&&(this.textobj.style.display="",this.textobj.style.width=b.style.width,this.textobj.style.height=b.style.height,b.style.width="0px",b.style.height="0px",b.style.border="none"),this.editwin=this.textobj,this.editdoc=this.textobj,this.editbox=this.textobj,this.spellobj=this.textobj,this.set_editor_width(this.textobj.style.width),a!==void 0&&this.write_editor_contents(a),this.editdoc.editorid=this.editorid,this.editwin.editorid=this.editorid,this.history.add_snapshot(this.get_editor_contents())},this.set_editor_width=function(a,b){if((this.textobj.style.oWidth===void 0||b)&&(this.textobj.style.oWidth=a),is_ie){this.textobj.style.width=this.textobj.style.oWidth;var c=this.textobj.offsetWidth;c>0&&(this.textobj.style.width=c+"px",this.textobj.style.width=c+c-this.textobj.offsetWidth+"px")}else this.textobj.style.width=a},this.set_editor_style=function(){},this.set_editor_functions=function(){this.editdoc.addEventListener?this.editdoc.addEventListener("keypress",vB_Text_Editor_Events.prototype.editdoc_onkeypress,!1):is_ie&&(this.editdoc.onkeydown=vB_Text_Editor_Events.prototype.editdoc_onkeypress),this.editwin.onfocus=vB_Text_Editor_Events.prototype.editwin_onfocus,this.editwin.onblur=vB_Text_Editor_Events.prototype.editwin_onblur
},this.set_context=function(){},this.apply_format=function(a,b,c){switch(a){case"bold":case"italic":case"underline":return this.wrap_tags(a.substr(0,1),!1),void 0;case"justifyleft":case"justifycenter":case"justifyright":return this.wrap_tags(a.substr(7),!1),void 0;case"indent":return this.wrap_tags(a,!1),void 0;case"fontname":return this.wrap_tags("font",c),void 0;case"fontsize":return this.wrap_tags("size",c),void 0;case"forecolor":return this.wrap_tags("color",c),void 0;case"createlink":var d=this.get_selection();return d?this.wrap_tags("url",c):this.wrap_tags("url",c,c),void 0;case"insertimage":return this.wrap_tags("img",!1,c),void 0;case"removeformat":return}},this.undo=function(){this.history.add_snapshot(this.get_editor_contents()),this.history.move_cursor(-1);var a;(a=this.history.get_snapshot())!==!1&&(this.editdoc.value=a)},this.redo=function(){this.history.move_cursor(1);var a;(a=this.history.get_snapshot())!==!1&&(this.editdoc.value=a)},this.strip_simple=function(a,b,c){var d="["+a+"]",e="[/"+a+"]";for(c===void 0&&(c=-1);(startindex=PHP.stripos(b,d))!==!1&&0!=c&&(c--,(stopindex=PHP.stripos(b,e))!==!1);){var f=b.substr(startindex+d.length,stopindex-startindex-d.length);b=b.substr(0,startindex)+f+b.substr(stopindex+e.length)}return b},this.strip_complex=function(a,b,c){var d="["+a+"=",e="[/"+a+"]";for(c===void 0&&(c=-1);(startindex=PHP.stripos(b,d))!==!1&&0!=c&&(c--,(stopindex=PHP.stripos(b,e))!==!1);){var f=PHP.stripos(b,"]",startindex);if(!(f!==!1&&f>startindex&&stopindex>f))break;var g=b.substr(f+1,stopindex-f-1);b=b.substr(0,startindex)+g+b.substr(stopindex+e.length)}return b},this.removeformat=function(){var b=Array("b","i","u"),c=Array("font","color","size"),d=this.get_selection();if(d!==!1){var e;for(e in b)YAHOO.lang.hasOwnProperty(b,e)&&(d=this.strip_simple(b[e],d));for(e in c)YAHOO.lang.hasOwnProperty(c,e)&&(d=this.strip_complex(c[e],d));this.insert_text(d)}},this.createlink=function(a,b){this.prompt_link("url",b,vbphrase.enter_link_url,"http://")},this.unlink=function(){var b=this.get_selection();b=this.strip_simple("url",b),b=this.strip_complex("url",b),this.insert_text(b)},this.email=function(a,b){this.prompt_link("email",b,vbphrase.enter_email_link,"")},this.insertsketchfab=function(a,b){var c="Please enter a valid model url.\n\n(example: https://sketchfab.com/show/x4ATBGtYWDF0yOyoi13xTwG9gkm)";if(b===void 0&&(b=this.show_prompt(c,"http://",!0)),b=this.verify_prompt(b)){b=b.replace(/^\s\s*/,"").replace(/\s\s*$/,"");var d=/^(http|https):\/\/sketchfab.com\/show\/(.+)$/;if(!d.test(b))return alert(c),!1;var e=b.substring(b.lastIndexOf("/")+1);return this.wrap_tags("sketchfab",!1,e)}return!1},this.insert_smilie=function(a,b){return this.check_focus(),this.insert_text(b,b.length,0)},this.prompt_link=function(a,b,c,d){return b===void 0&&(b=this.show_prompt(c,d,!0)),(b=this.verify_prompt(b))!==!1&&(this.get_selection()?(this.apply_format("unlink"),this.wrap_tags(a,b)):this.wrap_tags(a,b,b)),!0},this.insertorderedlist=function(){this.insertlist(vbphrase.insert_ordered_list,"1")},this.insertunorderedlist=function(){this.insertlist(vbphrase.insert_unordered_list,"")},this.insertlist=function(a,b){var e,c="[LIST"+(b?"="+b:"")+"]\n",d="[/LIST]";if(e=this.get_selection()){var f=RegExp("([\r\n]+|^[\r\n]*)(?!\\[\\*\\]|\\[\\/?list)(?=[^\r\n])","gi");e=c+PHP.trim(e).replace(f,"$1[*]")+"\n"+d,this.insert_text(e,e.vBlength(),0)}else if(this.insert_text(c+d,c.length,d.length),YAHOO.env.ua.ie>=7){var h,g=fetch_tags(document,"base");h=g&&g[0]&&g[0].href?g[0].href:"";var i=window.showModalDialog(h+"clientscript/ieprompt.html?",{value:"",label:vbphrase.enter_list_item,dir:document.dir,title:document.title,listtype:b},"dialogWidth:320px; dialogHeight:232px; dialogTop:"+(parseInt(window.screenTop)+parseInt(window.event.clientY)+parseInt(document.body.scrollTop)-100)+"px; dialogLeft:"+(parseInt(window.screenLeft)+parseInt(window.event.clientX)+parseInt(document.body.scrollLeft)-160)+"px; resizable: No;");this.verify_prompt(i)&&this.insert_text(i,i.vBlength(),0)}else for(;i=this.show_prompt(vbphrase.enter_list_item,"",!1);)i="[*]"+i+"\n",this.insert_text(i,i.vBlength(),0)},this.outdent=function(){var b=this.get_selection();b=this.strip_simple("indent",b,1),this.insert_text(b)},this.get_editor_contents=function(){return this.editdoc.value},this.get_selection=function(){return this.editdoc.selectionStart!==void 0?this.editdoc.value.substr(this.editdoc.selectionStart,this.editdoc.selectionEnd-this.editdoc.selectionStart):document.selection&&document.selection.createRange?document.selection.createRange().text:window.getSelection?window.getSelection()+"":!1},this.insert_text=function(a,b,c){var d=!1;if(this.check_focus(),this.editdoc.selectionStart!==void 0){var e=this.editdoc.selectionStart+0,f=this.editdoc.scrollTop;this.editdoc.value=this.editdoc.value.substr(0,this.editdoc.selectionStart)+a+this.editdoc.value.substr(this.editdoc.selectionEnd),b===!1||(b!==void 0?(this.editdoc.selectionStart=e+b,this.editdoc.selectionEnd=e+a.vBlength()-c):(this.editdoc.selectionStart=e,this.editdoc.selectionEnd=e+a.vBlength())),this.editdoc.scrollTop=f}else if(document.selection&&document.selection.createRange){var g=document.selection.createRange();g.text=a.replace(/\r?\n/g,"\r\n"),b===!1||(b!==void 0?(0!=b-a.vBlength()&&(g.moveStart("character",b-a.vBlength()),d=!0),0!=c&&(g.moveEnd("character",-c),d=!0)):(g.moveStart("character",-a.vBlength()),d=!0)),d&&g.select()}else this.editdoc.value+=a},this.prepare_submit=function(a,b){var c=validatemessage(this.textobj.value,a,b);return c?c:null!=this.captcha&&this.captcha.failed?c:(this.check_focus(),!1)},(is_saf||is_opera&&(!opera.version||8>opera.version()))&&(this.insertlist=function(a,b){var e,c="[LIST"+(b?"="+b:"")+"]\n",d="[/LIST]";if(e=this.get_selection()){var f=RegExp("([\r\n]+|^[\r\n]*)(?!\\[\\*\\]|\\[\\/?list)(?=[^\r\n])","gi");e=c+PHP.trim(e).replace(f,"$1[*]")+"\n"+d,this.insert_text(e,e.vBlength(),0)}else{for(this.insert_text(c,c.length,0);listvalue=prompt(vbphrase.enter_list_item,"");)listvalue="[*]"+listvalue+"\n",this.insert_text(listvalue,listvalue.vBlength(),0);this.insert_text(d,d.length,0)}})),this.init()}function vB_Text_Editor_Events(){}function save_iframe_to_textarea(){for(var a in vB_Editor)YAHOO.lang.hasOwnProperty(vB_Editor,a)&&vB_Editor[a].wysiwyg_mode&&vB_Editor[a].initialized&&(vB_Editor[a].textobj.value=vB_Editor[a].get_editor_contents())}function switch_editor_mode(a){if(AJAX_Compatible){var b=vB_Editor[a].wysiwyg_mode?0:1;if(1==vB_Editor[a].influx)return;vB_Editor[a].influx=1,"undefined"!=typeof vBmenu&&vBmenu.hide(),YAHOO.util.Connect.asyncRequest("POST","ajax.php?do=editorswitch",{success:do_switch_editor_mode,timeout:vB_Default_Timeout,argument:[a,b]},SESSIONURL+"securitytoken="+SECURITYTOKEN+"&do=editorswitch&towysiwyg="+b+"&parsetype="+vB_Editor[a].parsetype+"&allowsmilie="+vB_Editor[a].parsesmilies+"&message="+PHP.urlencode(vB_Editor[a].get_editor_contents())+(vB_Editor[a].ajax_extra?"&"+vB_Editor[a].ajax_extra:"")+(vB_Editor[a].textobj.form["options[allowbbcode]"]!==void 0?"&allowbbcode="+vB_Editor[a].textobj.form["options[allowbbcode]"].checked:""))}}function do_switch_editor_mode(a){if(a.responseXML){var b=vB_Editor[a.argument[0]].parsetype,c=vB_Editor[a.argument[0]].parsesmilies,d=vB_Editor[a.argument[0]].ajax_extra;vB_Editor[a.argument[0]].destroy();var e=a.responseXML.getElementsByTagName("message")[0];e!==void 0&&(e=e.firstChild);var f=e?e.nodeValue:"",g=f.match(/&#([0-9]+);/g);if(g)for(var h=0;g[h]!==void 0;h++)(submatch=g[h].match(/^&#([0-9]+);$/))&&(f=f.replace(submatch[0],String.fromCharCode(submatch[1])));vB_Editor[a.argument[0]]=new vB_Text_Editor(a.argument[0],a.argument[1],b,c,f,d),vB_Editor[a.argument[0]].check_focus(),fetch_object(a.argument[0]+"_mode").value=a.argument[1]}}function vB_History(){this.cursor=-1,this.stack=Array()}vB_Text_Editor_Events.prototype.smilie_onclick=function(a){return vB_Editor[this.editorid].insert_smilie(a,this.alt,this.src,this.id.substr(this.id.lastIndexOf("_")+1)),"undefined"==typeof smilie_window||smilie_window.closed||smilie_window.focus(),!1},vB_Text_Editor_Events.prototype.command_button_onmouseevent=function(a){a=do_an_e(a),"click"==a.type&&vB_Editor[this.editorid].format(a,this.cmd,!1,!0),vB_Editor[this.editorid].button_context(this,a.type)},vB_Text_Editor_Events.prototype.popup_button_onmouseevent=function(a){a=do_an_e(a),"click"==a.type?(this._onclick(a),vB_Editor[this.editorid].menu_context(this,"mouseover")):vB_Editor[this.editorid].menu_context(this,a.type)},vB_Text_Editor_Events.prototype.popup_button_show=function(a,b){var c=!0;if(vB_Editor[a.editorid].popups[a.cmd]===void 0||null==vB_Editor[a.editorid].popups[a.cmd])c=vB_Editor[a.editorid].init_popup_menu(a);else if("attach"==a.cmd&&("undefined"==typeof vB_Attachments||!vB_Attachments.has_attachments()))return fetch_object("manage_attachments_button").onclick(),void 0;c&&this._show(a,b)},vB_Text_Editor_Events.prototype.formatting_select_onchange=function(a){var b=this.options[this.selectedIndex].value;""!=b&&vB_Editor[this.editorid].format(a,this.cmd,b),this.selectedIndex=0},vB_Text_Editor_Events.prototype.smilieselect_onchange=function(a){""!=this.options[this.selectedIndex].value&&vB_Editor[this.editorid].insert_smilie(a,this.options[this.selectedIndex].value,this.options[this.selectedIndex].smiliepath,this.options[this.selectedIndex].smilieid),this.selectedIndex=0},vB_Text_Editor_Events.prototype.attachselect_onchange=function(){var b=this.options[this.selectedIndex].value;""!=b&&vB_Editor[this.editorid].wrap_tags("attach",!1,b),this.selectedIndex=0},vB_Text_Editor_Events.prototype.attachselect_onmouseover=function(){return 2>=this.options.length?(vB_Editor[this.editorid].build_attachments_popup(this),!0):void 0},vB_Text_Editor_Events.prototype.menuoption_onmouseevent=function(a){a=do_an_e(a),vB_Editor[this.editorid].button_context(this,a.type,"menu")},vB_Text_Editor_Events.prototype.formatting_option_onclick=function(a){vB_Editor[this.editorid].format(a,this.cmd,this.firstChild.innerHTML),vBmenu.hide()},vB_Text_Editor_Events.prototype.coloroption_onclick=function(a){fetch_object(this.editorid+"_color_bar").style.backgroundColor=this.colorname,vB_Editor[this.editorid].format(a,this.cmd,this.colorname),vBmenu.hide()},vB_Text_Editor_Events.prototype.colorout_onclick=function(a){return a=do_an_e(a),vB_Editor[this.editorid].format(a,"forecolor",fetch_object(this.editorid+"_color_bar").style.backgroundColor),!1},vB_Text_Editor_Events.prototype.smilieoption_onclick=function(a){vB_Editor[this.editorid].button_context(this,"mouseout","menu"),vB_Editor[this.editorid].insert_smilie(a,this.smilietext,fetch_tags(this,"img")[0].src,this.smilieid),vBmenu.hide()},vB_Text_Editor_Events.prototype.smiliemore_onclick=function(){vB_Editor[this.editorid].open_smilie_window(smiliewindow_x,smiliewindow_y),vBmenu.hide()},vB_Text_Editor_Events.prototype.attachmanage_onclick=function(){vBmenu.hide(),fetch_object("manage_attachments_button").onclick()},vB_Text_Editor_Events.prototype.attachoption_onclick=function(){vB_Editor[this.editorid].button_context(this,"mouseout","menu"),vB_Editor[this.editorid].wrap_tags("attach",!1,this.attachmentid),vBmenu.hide()},vB_Text_Editor_Events.prototype.attachinsertall_onclick=function(){var b="",c=vB_Editor[this.editorid].wysiwyg_mode?"<br /><br />":"\r\n\r\n";for(var d in vB_Attachments.attachments)YAHOO.lang.hasOwnProperty(vB_Attachments.attachments,d)&&(b+=""!=b?c:"",b+="[ATTACH]"+d+"[/ATTACH]");vB_Editor[this.editorid].insert_text(b),vBmenu.hide()},vB_Text_Editor_Events.prototype.smiliewindow_onunload=function(){"undefined"==typeof smilie_window||smilie_window.closed||smilie_window.close()},vB_Text_Editor_Events.prototype.editwin_onfocus=function(){this.hasfocus=!0},vB_Text_Editor_Events.prototype.editwin_onblur=function(){this.hasfocus=!1},vB_Text_Editor_Events.prototype.editdoc_onmouseup=function(){vB_Editor[this.editorid].set_context(),vB_Editor[this.editorid].popupmode&&vBmenu.hide()},vB_Text_Editor_Events.prototype.editdoc_onkeyup=function(){vB_Editor[this.editorid].set_context()},vB_Text_Editor_Events.prototype.editdoc_onkeypress=function(a){if(a||(a=window.event),a.ctrlKey&&!a.altKey){if(0==vB_Editor[this.editorid].allowbasicbbcode)return;var c,b=a.charCode?a.charCode:a.keyCode;switch(String.fromCharCode(b).toLowerCase()){case"b":c="bold";break;case"i":c="italic";break;case"u":c="underline";break;default:return}return a=do_an_e(a),vB_Editor[this.editorid].apply_format(c,!1,null),!1}if(9==a.keyCode){if(a.shiftKey||a.modifiers&&4&a.modifiers)return;if(is_opera)return;if(null!=fetch_object("tag_add_input"))fetch_object("tag_add_input").focus();else if(null!=fetch_object("rb_iconid_0"))fetch_object("rb_iconid_0").focus();else if(null!=fetch_object(this.editorid+"_save"))fetch_object(this.editorid+"_save").focus();else{if(null==fetch_object("qr_submit"))return;fetch_object("qr_submit").focus()}return a=do_an_e(a),void 0}},vB_Text_Editor_Events.prototype.editdoc_onresizestart=function(a){return"IMG"==a.srcElement.tagName?!1:void 0},window.attachEvent?window.attachEvent("onbeforeunload",save_iframe_to_textarea):window.addEventListener&&window.addEventListener("unload",save_iframe_to_textarea,!0);var contextcontrols=Array("bold","italic","underline","justifyleft","justifycenter","justifyright","insertorderedlist","insertunorderedlist"),coloroptions=Array();coloroptions={"#000000":"Black","#A0522D":"Sienna","#556B2F":"DarkOliveGreen","#006400":"DarkGreen","#483D8B":"DarkSlateBlue","#000080":"Navy","#4B0082":"Indigo","#2F4F4F":"DarkSlateGray","#8B0000":"DarkRed","#FF8C00":"DarkOrange","#808000":"Olive","#008000":"Green","#008080":"Teal","#0000FF":"Blue","#708090":"SlateGray","#696969":"DimGray","#FF0000":"Red","#F4A460":"SandyBrown","#9ACD32":"YellowGreen","#2E8B57":"SeaGreen","#48D1CC":"MediumTurquoise","#4169E1":"RoyalBlue","#800080":"Purple","#808080":"Gray","#FF00FF":"Magenta","#FFA500":"Orange","#FFFF00":"Yellow","#00FF00":"Lime","#00FFFF":"Cyan","#00BFFF":"DeepSkyBlue","#9932CC":"DarkOrchid","#C0C0C0":"Silver","#FFC0CB":"Pink","#F5DEB3":"Wheat","#FFFACD":"LemonChiffon","#98FB98":"PaleGreen","#AFEEEE":"PaleTurquoise","#ADD8E6":"LightBlue","#DDA0DD":"Plum","#FFFFFF":"White"},vB_History.prototype.move_cursor=function(a){var b=this.cursor+a;b>=0&&null!=this.stack[b]&&this.stack[b]!==void 0&&(this.cursor+=a)},vB_History.prototype.add_snapshot=function(a){this.stack[this.cursor]!=a&&(this.cursor++,this.stack[this.cursor]=a,this.stack[this.cursor+1]!==void 0&&(this.stack[this.cursor+1]=null))},vB_History.prototype.get_snapshot=function(){return this.stack[this.cursor]!==void 0&&null!=this.stack[this.cursor]?this.stack[this.cursor]:!1};